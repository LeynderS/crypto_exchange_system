@startuml

class UserService{
-final InMemoryUserRepository userRepository
-static final String EMAIL_REGEX
-static final Pattern EMAIL_PATTERN
-User currentUser
+registerUser(String name, String email, String password)
+login(String email, String password)
+logout()
+validateEmail(String email)
+emailInUse(String email)
+getCurrentUser(): User
+isLoggedIn(): boolean
}

class InMemoryUserRepository {
  -Map<String, User> users
  +save(User user)
  +getUserByEmail(String email): User
}

class User {
-String userId
-String name
-String email
-String password
-Wallet wallet
+getEmail(): String
+getPassword(): String
+getName(): String
}

class WalletService{
-Wallet wallet
+depositFiat(BigDecimal amount)
+withdrawFiat(BigDecimal amount)
+depositCrypto(CryptoCurrency cryptoCurrency, BigDecimal amount)
+withdrawCrypto(CryptoCurrency cryptoCurrency, BigDecimal amount)
+viewBalance(): String
}

class Wallet {
-BigDecimal fiatBalance
-Map<CryptoCurrency, BigDecimal> cryptoBalances
+depositFiat(BigDecimal amount)
+withdrawFiat(BigDecimal amount)
+depositCrypto(CryptoCurrency cryptoCurrency, BigDecimal amount)
+withdrawCrypto(CryptoCurrency cryptoCurrency, BigDecimal amount)
+viewBalance(): String
}

class CryptoCurrencyRepository{
getCryptoCurrencyBySymbol(String symbol): CryptoCurrency
}

class SystemExchangeService{
-CryptoCurrencyRepository cryptoCurrencyRepository
-final Map<CryptoCurrency, BigDecimal> cryptosMarketPrice
-final Map<CryptoCurrency, BigDecimal> cryptosAvailability
+sufficientCryptos(String symbol, BigDecimal amount)
+getTotalPrice(String symbol, BigDecimal amount): BigDecimal
+buyCryptoCurrency(String symbol, BigDecimal amount): CryptoCurrency
+getAvailableCryptosAndMarketPrice(): BigDecimal
}

abstract class Order {
-String orderId
-User user
-CryptoCurrency cryptoCurrency
-BigDecimal amount
-LocalDateTime date
}

class BuyOrder {
-BigDecimal maxPrice
}

class SellOrder{
-BigDecimal minPrice
}

class OrderBook{
-static OrderBook instance
-TransactionService transactionService
-List<Order> buyOrders
-List<Order> sellOrders
+static OrderBook getInstance()
+addOrder(Order order)
-matchOrders()
-findMatchingOrders(): Order[]
-ordersMatch(Order buyOrder, Order sellOrder): boolean
-removeMatchedOrders(Order buyOrder, Order sellOrder)
}

class TransactionRepository {
-final Map<User, List<Transaction>> transactions
+save(User user, Transaction transaction)
+getTransactions(User user): List<Transaction>
}

class Transaction {
-String transactionId
-CryptoCurrency cryptoCurrency
-BigDecimal amount
-BigDecimal price
-TransactionType type
-LocalDateTime timestamp
}

class TransactionService {
-final TransactionRepository transactionRepository
+saveTransaction(User user, CryptoCurrency cryptoCurrency, BigDecimal amount, BigDecimal price, TransactionType type)
+getTransactions(User user): List<Transaction>
processTransaction(Order buyOrder, Order sellOrder)
}


class CryptoCurrency {
-String symbol
-String name
}

enum TransactionType {
BUY
SELL
}

UserService "1" --> "1" InMemoryUserRepository : Uses
InMemoryUserRepository "1" *-- "0..*" User : Stores
User "1" *-- "1" Wallet : contains
Wallet "1" <-- "1" WalletService : Uses
Wallet "1" o-- "0..*" CryptoCurrency : Contains
CryptoCurrencyRepository "1" --> "1..*" CryptoCurrency : provides
SystemExchangeService "1 "--> "1" CryptoCurrencyRepository : uses
Order <|-- BuyOrder
Order <|-- SellOrder
OrderBook "1" *-- "0..*" Order : contains
OrderBook "1" --> "1" TransactionService : interacts with
TransactionRepository "1" *-- "0..*" Transaction: contains
TransactionService "1" --> "1" TransactionRepository : Uses
Transaction "1" o-- "1" CryptoCurrency
Order "1" --> "1" User : BelongsTo
TransactionRepository "1" --> "0..*" User : manages

@enduml